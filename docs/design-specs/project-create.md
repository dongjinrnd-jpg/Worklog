# 프로젝트 등록 페이지 설계 문서

## 1. 개요

프로젝트 등록 기능은 사용자가 새로운 프로젝트 정보를 등록할 수 있게 하는 기능입니다. 사용자는 진행여부, 고객사, ITEM, PART NO 등 다양한 프로젝트 관련 정보를 입력하고 저장할 수 있습니다. 입력된 데이터는 Google 스프레드시트의 `프로젝트` 시트에 저장됩니다.

---

## 2. 기능 요구사항

### 필수 기능
- 프로젝트 정보 등록 폼 제공
  - NO, 진행여부, 고객사, 소속, 모델, ITEM, PART NO, 개발담당, 개발업무단계, 대일정, 현재단계, 업무진행사항, 애로사항, 비고, 업무추가 일정계획, 판매가, 재료비, 재료비율 입력 필드 구현
- 개발담당자 다중 선택 기능
  - `담당자` 시트 데이터 활용
  - 직급과 이름 함께 표시
  - 검색 기능으로 담당자 빠르게 찾기
- 유효성 검증
  - 필수 입력 필드 검증
  - 입력 형식 검증 (날짜, 텍스트 길이 등)
- 성공/실패 피드백 UI
  - 저장 작업 결과 피드백 제공

### 프로젝트 등록 폼 세부 기능
- 저장 시 NO 자동 할당 (현재 프로젝트에 등록된 가장 큰 번호 + 1)
- 필수 필드 표시 (*)
- 진행여부 선택 (라디오 버튼, 기본값: 진행)
- 고객사 및 ITEM 필수 입력 필드
- PART NO 선택적 입력 필드 
- 개발담당 다중 선택 컴포넌트
- 개발업무단계 다중 선택 컴포넌트 (`항목정보` 시트 참조)
  - 현재단계는 선택한 개발업무단계 중 첫 번째 항목으로 자동 설정
- 대일정 날짜 범위 선택기
- 저장/취소/초기화 버튼

---

## 3. UI/UX 설계

### 새 프로젝트 등록 모달
```
+------------------------------------------+
|    새 프로젝트 등록     |      X        |
+------------------------------------------+
| 진행여부*:     | [라디오 버튼]          |
|               | ● 진행 ○ 보유 ○ 완료    |
+------------------------------------------+
| 고객사*:       | [고객사 입력 필드]     |
|               | (항목정보 시트 D열 참조) |
+------------------------------------------+
| 소속:          | [소속 입력 필드]       |
|               | (항목정보 시트 B열 참조) |
+------------------------------------------+
| 모델:          | [모델 입력 필드]       |
|               | (항목정보 시트 C열 참조) |
+------------------------------------------+
| ITEM*:         | [ITEM 입력 필드]       |
+------------------------------------------+
| PART NO:       | [PART NO 입력 필드]    |
+------------------------------------------+
| 개발담당:      | [담당자 다중 선택]     |
+------------------------------------------+
| 개발업무단계:  | [업무단계 다중 선택]   |
|               | (항목정보 시트 A열 참조) |
+------------------------------------------+
| 대일정(시작일): | [날짜 선택기]          |
+------------------------------------------+
| 대일정(종료일): | [날짜 선택기]          |
+------------------------------------------+
| 판매가:        | [숫자 입력 필드]       |
+------------------------------------------+
| 재료비:        | [숫자 입력 필드]       |
+------------------------------------------+
| 재료비율(%):   | [숫자 입력 필드]       |
+------------------------------------------+
|                                          |
| [저장하기]     [취소]     [초기화]       |
+------------------------------------------+
```

---

## 4. 데이터 흐름

### 프로젝트 등록 흐름
- [새 프로젝트 등록] 버튼 클릭 → 모달 표시
- 폼 데이터 입력 및 유효성 검증
- 저장 버튼 클릭 → Google Sheets API를 통해 `프로젝트` 시트에 데이터 추가
- 성공/실패 피드백 제공
- 성공 시 모달 닫기 및 프로젝트 목록 갱신 (revalidatePath/revalidateTag)

---

## 5. 기술 스택 및 컴포넌트

### 프론트엔드 기술
- Next.js 서버 컴포넌트 / 클라이언트 컴포넌트 분리
- Shadcn UI 컴포넌트 라이브러리
  - `Dialog` 컴포넌트: 프로젝트 등록 모달
  - `Form` 컴포넌트: 입력 폼 및 유효성 검증
  - `DatePicker` 컴포넌트: 날짜 및 기간 선택
  - `MultiSelect` 컴포넌트: 개발담당자 다중 선택
  - `Button` 등 기본 UI 컴포넌트
- React Hook Form: 폼 상태 관리 및 유효성 검증
- Zod: 스키마 기반 폼 유효성 검증

### 백엔드 기술
- Next.js 서버 액션을 활용한 데이터 저장
- Google Sheets API를 통한 데이터 추가

---

## 6. API 설계

### 프로젝트 생성 서버 액션

```typescript
export interface Project {
  id: string;
  no: number;
  status: 'progress' | 'hold' | 'completed'; // 진행여부 (진행, 보유, 완료)
  customer: string;
  item: string;
  partNo?: string;
  managers?: string[];
  developmentStages?: string[]; // 다중 선택 가능한 개발업무단계
  schedule?: { start?: string; end?: string } | null;
  progress?: string; // 업무진행사항
  additionalPlan?: string; // 업무추가 일정계획
  issues?: string; // 애로사항
  issueResolved?: boolean; // 애로사항 개선 여부
  sellingPrice?: number; // 판매가
  materialCost?: number; // 재료비
  materialCostRatio?: number; // 재료비율
  createdAt: string;
  updatedAt: string;
}

/**
 * developmentStages 필드 설명:
 * - 사용자가 다중 선택한 개발업무단계 목록이 문자열 배열로 저장됩니다.
 * - 예시: ['검토', '설계', '개발']
 * - 이는 `항목정보` 시트에서 가져온 목록 중 사용자가 선택한 항목들입니다.
 * - 스프레드시트에 저장될 때는 쉼표로 구분된 문자열로 변환됩니다 (managersStr 변수 참조).
 * - 첫 번째 항목(developmentStages[0])은 현재단계로 자동 설정됩니다.
 */

export const createProject = async (data: Omit<Project, 'id' | 'no' | 'createdAt' | 'updatedAt'>) => {
  try {
    // ... existing code ...
    
    // 개발담당자와 개발업무단계를 쉼표로 구분된 문자열로 변환
    const managersStr = data.managers && data.managers.length > 0 ? data.managers.join(',') : '';
    const stagesStr = data.developmentStages && data.developmentStages.length > 0 ? data.developmentStages.join(',') : '';
    
    // Google Sheets API로 데이터 전송
    const values = [
      [
        newNo.toString(), // NO (자동생성)
        statusMap[data.status] || '진행', // 진행여부
        data.customer,    // 고객사
        data.affiliation || '', // 소속
        data.model || '', // 모델
        data.item,        // ITEM
        data.partNo || '', // PART NO
        managersStr,      // 개발담당
        stagesStr,        // 개발업무단계
        data.schedule ? `${data.schedule.start || ''} ~ ${data.schedule.end || ''}` : '', // 대일정
        data.developmentStages && data.developmentStages.length > 0 ? data.developmentStages[0] : '', // 현재단계 (개발업무단계의 첫 번째 항목)
        data.progress || '', // 업무진행사항
        data.issues || '', // 애로사항
        data.notes || '', // 비고
        data.additionalPlan || '', // 업무추가 일정계획
        data.sellingPrice || '', // 판매가
        data.materialCost || '', // 재료비
        data.materialCostRatio || '', // 재료비율
        new Date().toISOString(), // createdAt
        new Date().toISOString(), // updatedAt
      ]
    ];
    
    // ... existing code ...
  }
};
```

---

## 7. 구현 계획

### 프로젝트 등록 기능 구현
- 프로젝트 등록 폼 컴포넌트 구현
- 담당자 다중 선택 기능 구현
- 유효성 검증 로직 구현
- Google Sheets API 연동하여 데이터 저장 기능 구현
- 성공/실패 피드백 UI 구현

---

## 8. 시트 구조

### 📊 Google Spreadsheet 이름: **`프로젝트관리`**

#### 📄 프로젝트 시트 (`프로젝트`)
| NO | 단계 | 고객사 | 소속 | 모델 | 개발담당 | ITEM | PART NO | 개발업무단계 | 대일정(시작일) | 대일정(종료일) | 현재단계 | 업무진행사항 | 애로사항 | 비고 | 업무추가 일정계획 | 판매가 | 재료비 | 재료비율(%) |
|----|------|--------|------|------|-----------|------|---------|--------------|---------------|---------------|----------|--------------|---------|------|-------------------|--------|--------|-------------|

#### 📄 담당자 시트 (`담당자`)
| 직급 | 이름 |
|------|------|

#### 📄 항목정보 시트 (`항목정보`)
| 개발단계명 | 소속  | 모델 | 고객사
|----------|------|------| ------|
| 검토 | 전장 | CAB TILT SYSTEM | 기아군수
| 설계 | 유압 | FUEL FILLER PUMP | KUBOTA
| 개발 | 전산 | PUMP | YAMADA
| PROTO |    | CYLINDER | DORMAN
| 선행성 |    | ETB |
| P1 |       | TC ACTUATOR MOTOR |
| P2 |
| 승인 |
| 양산이관 |
| 초도양산 |



**참고사항:**
- 항목정보 시트는 네 개의 열(A,B,C,D)로 구성되어 있습니다.
- 프로젝트 추가 시 다음과 같이 작동합니다:
  1. 개발단계명: "항목정보" 시트의 A열을 참조합니다.
  2. 소속: "항목정보" 시트의 B열을 참조합니다.
  3. 모델: "항목정보" 시트의 C열을 참조합니다.
  4. 고객사: "항목정보" 시트의 D열을 참조합니다.
- 프로젝트 등록 시 사용자는 위 목록에서 다중 선택이 가능합니다.

===========
난이도: 중간  
학습 키워드: Next.js, Google Sheets API, 서버 컴포넌트, React Hook Form, Zod, 폼 상태 관리, 유효성 검증
=========== 